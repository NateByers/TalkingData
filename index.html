<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>TalkingData Mobile User Demographics</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/default.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>

<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 45px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 50px;
  margin-top: -50px;
}

.section h2 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h3 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h4 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h5 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h6 {
  padding-top: 50px;
  margin-top: -50px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">TalkingData Project</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Documentation
  </a>
</li>
<li>
  <a href="table.html">
    <span class="fa fa-table"></span>
     
    Data Table
  </a>
</li>
<li>
  <a href="Application.html">
    <span class="fa fa-tachometer"></span>
     
    Application
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/NateByers/TalkingData">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">TalkingData Mobile User Demographics</h1>

</div>


<p>This project uses data from the <a href="https://www.kaggle.com/c/talkingdata-mobile-user-demographics">TalkingData Mobile User Demographics</a> Kaggle competition.</p>
<p>TalkingData is a Chinese based mobile data platform. From the competition site:</p>
<blockquote>
<p>In this competition, Kagglers are challenged to build a model predicting usersâ€™ demographic characteristics based on their app usage, geolocation, and mobile device properties. Doing so will help millions of developers and brand advertisers around the world pursue data-driven marketing efforts which are relevant to their users and catered to their preferences.</p>
</blockquote>
<div id="the-data" class="section level1">
<h1>The Data</h1>
<p>The data for the competition can be downloaded here: <a href="https://www.kaggle.com/c/talkingdata-mobile-user-demographics/data" class="uri">https://www.kaggle.com/c/talkingdata-mobile-user-demographics/data</a> .</p>
<p>I have downloaded and read each file into R, giving each <code>data.frame</code> the same name as the file. Below are the first 3 records of each file.</p>
<pre class="r"><code>head(app_events, 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">event_id</th>
<th align="right">app_id</th>
<th align="right">is_installed</th>
<th align="right">is_active</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1924946</td>
<td align="right">3.489720e+18</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">19620</td>
<td align="right">7.723979e+18</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">53629</td>
<td align="right">7.723979e+18</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<pre class="r"><code>head(app_labels, 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">app_id</th>
<th align="right">label_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-2.600988e+18</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">-2.600988e+18</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">4.214070e+18</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<pre class="r"><code>head(events, 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">event_id</th>
<th align="right">device_id</th>
<th align="left">timestamp</th>
<th align="right">longitude</th>
<th align="right">latitude</th>
<th align="left">region</th>
<th align="left">date</th>
<th align="right">hour</th>
<th align="left">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1924946</td>
<td align="right">-7.013555e+18</td>
<td align="left">2016-05-06 07:39:53</td>
<td align="right">109.46</td>
<td align="right">21.89</td>
<td align="left">NA</td>
<td align="left">2016-05-06</td>
<td align="right">7</td>
<td align="left">morning</td>
</tr>
<tr class="even">
<td align="right">19620</td>
<td align="right">8.427965e+18</td>
<td align="left">2016-05-07 17:38:53</td>
<td align="right">117.35</td>
<td align="right">25.34</td>
<td align="left">NA</td>
<td align="left">2016-05-07</td>
<td align="right">17</td>
<td align="left">midday</td>
</tr>
<tr class="odd">
<td align="right">53629</td>
<td align="right">-6.506152e+18</td>
<td align="left">2016-05-03 18:55:04</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="left">NA</td>
<td align="left">2016-05-03</td>
<td align="right">18</td>
<td align="left">evening</td>
</tr>
</tbody>
</table>
<pre class="r"><code>head(gender_age_train, 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">device_id</th>
<th align="left">gender</th>
<th align="right">age</th>
<th align="left">group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">8.427965e+18</td>
<td align="left">F</td>
<td align="right">23</td>
<td align="left">F23-</td>
</tr>
<tr class="even">
<td align="right">-3.293695e+18</td>
<td align="left">M</td>
<td align="right">40</td>
<td align="left">M39+</td>
</tr>
<tr class="odd">
<td align="right">7.104535e+18</td>
<td align="left">M</td>
<td align="right">25</td>
<td align="left">M23-26</td>
</tr>
</tbody>
</table>
<pre class="r"><code>head(phone_brand_device_model, 3) # Chinese characters displayed in UTF-8 codes</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">device_id</th>
<th align="left">phone_brand</th>
<th align="left">device_model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">8.427965e+18</td>
<td align="left">vivo</td>
<td align="left">X5M</td>
</tr>
<tr class="even">
<td align="right">1.186608e+18</td>
<td align="left"><U+5C0F><U+7C73></td>
<td align="left"><U+7EA2><U+7C73>2</td>
</tr>
<tr class="odd">
<td align="right">1.186608e+18</td>
<td align="left"><U+5C0F><U+7C73></td>
<td align="left"><U+7EA2><U+7C73></td>
</tr>
</tbody>
</table>
<p><br><br></p>
<p>The number of records in each <code>data.frame</code> can be seen in the table below.</p>
<p><br><br></p>
<table>
<thead>
<tr class="header">
<th align="left">Table</th>
<th align="left">Records</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">app_events</td>
<td align="left">12,732,996</td>
</tr>
<tr class="even">
<td align="left">app_labels</td>
<td align="left">459,943</td>
</tr>
<tr class="odd">
<td align="left">events</td>
<td align="left">3,252,950</td>
</tr>
<tr class="even">
<td align="left">gender_age_train</td>
<td align="left">74,645</td>
</tr>
<tr class="odd">
<td align="left">phone_brand_device_model</td>
<td align="left">187,245</td>
</tr>
</tbody>
</table>
<p><br><br></p>
<p>And below is the data schema provided on the Kaggle site.</p>
<p><br><br></p>
<div class="figure">
<img src="img/schema.png" alt="" />

</div>
<p><br><br></p>
</div>
<div id="tidy-data" class="section level1">
<h1>Tidy Data</h1>
<p>For our purpose, it is more convenient to look at the data in one nice “tidy” table. I have joined the tables and created some new columns that help make sense of the data. You can see the data by clicking on “Data Table” in the banner above. Below is a data dictionary.</p>
<table>
<thead>
<tr class="header">
<th align="left">Fields</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">event_id</td>
<td align="left">Unique mobile event identifier. The primary key for this table.</td>
</tr>
<tr class="even">
<td align="left">device_id</td>
<td align="left">The mobile device identifier. Demographics are associated with this number.</td>
</tr>
<tr class="odd">
<td align="left">longitude; latitude</td>
<td align="left">Geolocation</td>
</tr>
<tr class="even">
<td align="left">region</td>
<td align="left">Feature generated from the data. Most events in china take place in three cities: Beijing, Chengdu, Hong Kong, and Shanghai.</td>
</tr>
<tr class="odd">
<td align="left">date; hour; time</td>
<td align="left">Time</td>
</tr>
<tr class="even">
<td align="left">gender; age</td>
<td align="left">Demographics</td>
</tr>
<tr class="odd">
<td align="left">phone_brand; device_model</td>
<td align="left">Mobile device brand information.</td>
</tr>
<tr class="even">
<td align="left">apps</td>
<td align="left">Feature generated from the data. The number of active apps during the event.</td>
</tr>
<tr class="odd">
<td align="left">Custom; Education; etc.</td>
<td align="left">These columns are also features generated from the data. These are categories of apps that are active during the event. A value of 1 means that at least 1 app from this category is active. See the file generalizeCategories.R in the GitHub repository for the R code that generated these features.</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: The Chinese characters for the phone brand and device model are rendered as their UTF-8 code or sometimes not at all.</p>
</div>
<div id="data-exploration" class="section level1">
<h1>Data Exploration</h1>
<p>The tidy data set can be visualized using the TalkingData Explorer found here: <a href="https://natebyers.shinyapps.io/TalkingData_Explorer/" class="uri">https://natebyers.shinyapps.io/TalkingData_Explorer/</a> .</p>
<p>Below are plots that vizualize the distribution of gender and age.</p>
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="prediction" class="section level1">
<h1>Prediction</h1>
<p>Random forest model for predicting gender.</p>
<pre class="r"><code>library(caret)
for(i in names(full_data)){
  if(class(full_data[[i]]) == &quot;character&quot;){
    full_data[[i]] &lt;- as.factor(full_data[[i]])
  }
}

gender_subset &lt;- full_data %&gt;%
  arrange(gender) %&gt;%
  sample_n(2000) %&gt;%
  select(gender, region, hour, phone_brand, Games, Education, Finance)

ctrl &lt;- trainControl(method=&quot;repeatedcv&quot;, number=2, repeats=1, 
                     selectionFunction = &quot;oneSE&quot;)
in_train &lt;- createDataPartition(gender_subset$gender, p=.80, list=FALSE)

rf &lt;- train(gender ~ ., data = gender_subset, method = &quot;rf&quot;,
            metric = &quot;Kappa&quot;, trControl = ctrl, subset = in_train)

test &lt;- gender_subset[-in_train,]
test$pred &lt;- predict(rf, test, &quot;raw&quot;)
confusionMatrix(test$pred, test$gender)</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction   F   M
##          F  10  19
##          M  90 280
##                                         
##                Accuracy : 0.7268        
##                  95% CI : (0.6803, 0.77)
##     No Information Rate : 0.7494        
##     P-Value [Acc &gt; NIR] : 0.8634        
##                                         
##                   Kappa : 0.0477        
##  Mcnemar&#39;s Test P-Value : 2.017e-11     
##                                         
##             Sensitivity : 0.10000       
##             Specificity : 0.93645       
##          Pos Pred Value : 0.34483       
##          Neg Pred Value : 0.75676       
##              Prevalence : 0.25063       
##          Detection Rate : 0.02506       
##    Detection Prevalence : 0.07268       
##       Balanced Accuracy : 0.51823       
##                                         
##        &#39;Positive&#39; Class : F             
## </code></pre>
<pre class="r"><code>prd &lt;- data.frame(region = &quot;Hong Kong&quot;, hour = 12, phone_brand = &quot;vivo&quot;,
                  Games = 1, Education = 1, Finance = 0)
predict(rf, prd)</code></pre>
<pre><code>## [1] M
## Levels: F M</code></pre>
<p>Linear model for predicting age.</p>
<pre class="r"><code>age_subset &lt;- full_data %&gt;%
  arrange(age) %&gt;%
  sample_n(2000)

split&lt;-createDataPartition(age_subset$age, p = 0.6, list = FALSE)

dev&lt;-age_subset[split,] %&gt;%
  select(age, region, hour, phone_brand, Games, Education,
         Finance)

val&lt;-age_subset[-split,] %&gt;%
  select(age, region, hour, phone_brand, Games, Education,
         Finance)

ctrl&lt;-trainControl(method = &quot;cv&quot;, number = 2)

lm&lt;-train(age~., data = dev, method = &quot;lm&quot;, trControl = ctrl)

lm</code></pre>
<pre><code>## Linear Regression 
## 
## 1202 samples
##    6 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (2 fold) 
## Summary of sample sizes: 602, 600 
## Resampling results:
## 
##   RMSE      Rsquared  
##   9.129228  0.03066149
## 
## </code></pre>
<pre class="r"><code>predict(lm, prd)</code></pre>
<pre><code>##        1 
## 27.83763</code></pre>
</div>
<div id="application" class="section level1">
<h1>Application</h1>
<p>The models can be used to make a prediction of the users gender and age. Below is an application that gives an estimated age and gender based on the user inputs.</p>
<iframe src="https://natebyers.shinyapps.io/TalkingData_Prediction/" style="border: none; width: 440px; height: 900px">
</iframe>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
